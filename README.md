# <div align="center">Echidna Library for Go</div>

![background image](echidna.png)
<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# echidna

```go
import "github.com/bruceesmith/echidna"
```

Package echidna provides helpers for building robust Go daemons and CLIs

Type Terminator permits orderly stopping / shutdown of a group of goroutines via methods which mimic stop of a sync.WaitGroup. There is a default Terminator accessible through top level functions \(Add, Done, Wait and so on\) that call the corresponding Terminator methods.

Another group of functions support logging and tracing. Debug, Error, Info and Warn operate like their package slog equivalents, with the level of logging modifiable using SetLevel. A custom logging level \(LevelTrace\) can be supplied to SetLevel to enable tracing. Tracing can be unconditional when calling Trace, or only enabled for pre\-defined identifiers when calling TraceID. Identifiers for TraceID are registered by calling SetTraceIDs. By default, all debug, error, info and warn messages go to Stdout, and traces go to Stderr; these destinations can be changed by calling RedirectNormal and RedirectTrace respectively.

Type Set defines methods for manipulating a generic set data structure via the expected operations Add, Contains, Intersection, Members, String and Union.

## Index

- [Variables](<#variables>)


## Variables

<a name="Program"></a>

```go
var (
    // Program is the program name
    Program string
    // Version is the program version
    Version string
)
```

<a name="BuildDate"></a>

```go
var (
    // BuildDate is the timestamp for when this program was compiled
    BuildDate string = `Filled in during the build`
    // ErrConfigOK is returned when --checkcfg finds the configuration in good order
    ErrConfigOK = errors.New("configuration is OK")
    // ErrVersion is returned when --version is given
    ErrVersion = errors.New("version requested")
)
```

# custom

```go
import "github.com/bruceesmith/echidna/custom"
```

## Index

- [func Init\[E any\]\(prog, ver string, config \*E, unmarshal func\(\[\]byte, \*E\) error, validate func\(cf \*E\) error, flagfuncs ...func\(\)\) \(err error\)](<#Init>)


<a name="Init"></a>
## func Init

```go
func Init[E any](prog, ver string, config *E, unmarshal func([]byte, *E) error, validate func(cf *E) error, flagfuncs ...func()) (err error)
```

Init initialises the echidna package for the use case where the program does not provide and "comamnds" on the command line and it uses a custom package to handle the configuration

# logger

```go
import "github.com/bruceesmith/echidna/logger"
```

## Index

- [Constants](<#constants>)
- [func Debug\(msg string, args ...any\)](<#Debug>)
- [func Error\(msg string, args ...any\)](<#Error>)
- [func Info\(msg string, args ...any\)](<#Info>)
- [func Level\(\) string](<#Level>)
- [func RedirectStandard\(w io.Writer\)](<#RedirectStandard>)
- [func RedirectTrace\(w io.Writer\)](<#RedirectTrace>)
- [func SetLevel\(l slog.Level\)](<#SetLevel>)
- [func SetTraceIds\(ids ...string\)](<#SetTraceIds>)
- [func Trace\(msg string, args ...any\)](<#Trace>)
- [func TraceID\(id string, msg string, args ...any\)](<#TraceID>)
- [func Warn\(msg string, args ...any\)](<#Warn>)
- [type LogLevel](<#LogLevel>)
  - [func \(ll \*LogLevel\) Set\(ls string\) \(err error\)](<#LogLevel.Set>)
  - [func \(ll \*LogLevel\) String\(\) \(s string\)](<#LogLevel.String>)
  - [func \(ll \*LogLevel\) Type\(\) string](<#LogLevel.Type>)


## Constants

<a name="LevelTrace"></a>

```go
const (
    // LevelTrace can be set to enable tracing
    LevelTrace slog.Level = -10
)
```

<a name="Debug"></a>
## func Debug

```go
func Debug(msg string, args ...any)
```

Debug emits a debug log

<a name="Error"></a>
## func Error

```go
func Error(msg string, args ...any)
```

Error emits an error log

<a name="Info"></a>
## func Info

```go
func Info(msg string, args ...any)
```

Info emits an info log

<a name="Level"></a>
## func Level

```go
func Level() string
```



<a name="RedirectStandard"></a>
## func RedirectStandard

```go
func RedirectStandard(w io.Writer)
```

RedirectStandard changes the destination for normal \(non\-trace\) logs

<a name="RedirectTrace"></a>
## func RedirectTrace

```go
func RedirectTrace(w io.Writer)
```

RedirectTrace changes the destination for normal \(non\-trace\) logs

<a name="SetLevel"></a>
## func SetLevel

```go
func SetLevel(l slog.Level)
```

SetLevel sets the default level of logging

<a name="SetTraceIds"></a>
## func SetTraceIds

```go
func SetTraceIds(ids ...string)
```

SetTraceIds registers identifiers for future tracing

<a name="Trace"></a>
## func Trace

```go
func Trace(msg string, args ...any)
```

Trace emits one JSON\-formatted log entry if trace level logging is enabled

<a name="TraceID"></a>
## func TraceID

```go
func TraceID(id string, msg string, args ...any)
```

TraceID emits one JSON\-formatted log entry if tracing is enabled for the requested ID

<a name="Warn"></a>
## func Warn

```go
func Warn(msg string, args ...any)
```

Warn emits a warning log

<a name="LogLevel"></a>
## type LogLevel

LogLevel is the level of logging

```go
type LogLevel int
```

<a name="LogLevel.Set"></a>
### func \(\*LogLevel\) Set

```go
func (ll *LogLevel) Set(ls string) (err error)
```

Set is a convenience method for pflag.Value

<a name="LogLevel.String"></a>
### func \(\*LogLevel\) String

```go
func (ll *LogLevel) String() (s string)
```

String is a convenience method for pflag.Value

<a name="LogLevel.Type"></a>
### func \(\*LogLevel\) Type

```go
func (ll *LogLevel) Type() string
```

Type is a conveniene method for pflag.Value

# set

```go
import "github.com/bruceesmith/echidna/set"
```

## Index

- [type Set](<#Set>)
  - [func New\[E comparable\]\(vals ...E\) \*Set\[E\]](<#New>)
  - [func \(s \*Set\[E\]\) Add\(vals ...E\)](<#Set[E].Add>)
  - [func \(s \*Set\[E\]\) Contains\(v E\) bool](<#Set[E].Contains>)
  - [func \(s \*Set\[E\]\) Intersection\(s2 \*Set\[E\]\) \*Set\[E\]](<#Set[E].Intersection>)
  - [func \(s \*Set\[E\]\) Members\(\) \[\]E](<#Set[E].Members>)
  - [func \(s \*Set\[E\]\) String\(\) string](<#Set[E].String>)
  - [func \(s \*Set\[E\]\) Union\(s2 \*Set\[E\]\) \*Set\[E\]](<#Set[E].Union>)


<a name="Set"></a>
## type Set

Set is a generics implementation of the set data type

```go
type Set[E comparable] struct {
    // contains filtered or unexported fields
}
```

<a name="New"></a>
### func New

```go
func New[E comparable](vals ...E) *Set[E]
```

New creates a new Set

<a name="Set[E].Add"></a>
### func \(\*Set\[E\]\) Add

```go
func (s *Set[E]) Add(vals ...E)
```

Add puts a new value into a Set

<a name="Set[E].Contains"></a>
### func \(\*Set\[E\]\) Contains

```go
func (s *Set[E]) Contains(v E) bool
```

Contains checks if a value is in the Set

<a name="Set[E].Intersection"></a>
### func \(\*Set\[E\]\) Intersection

```go
func (s *Set[E]) Intersection(s2 *Set[E]) *Set[E]
```

Intersection returns the logical intersection of 2 Sets

<a name="Set[E].Members"></a>
### func \(\*Set\[E\]\) Members

```go
func (s *Set[E]) Members() []E
```

Members returns a slice of the values in a Set

<a name="Set[E].String"></a>
### func \(\*Set\[E\]\) String

```go
func (s *Set[E]) String() string
```

String returns a string representation of the Set members

<a name="Set[E].Union"></a>
### func \(\*Set\[E\]\) Union

```go
func (s *Set[E]) Union(s2 *Set[E]) *Set[E]
```

Union returns the logical union of 2 Sets

# terminator

```go
import "github.com/bruceesmith/echidna/terminator"
```

## Index

- [func Add\(delta int\)](<#Add>)
- [func Done\(\)](<#Done>)
- [func SetDefault\(t \*Terminator\)](<#SetDefault>)
- [func ShutDown\(\) \<\-chan struct\{\}](<#ShutDown>)
- [func ShuttingDown\(\) bool](<#ShuttingDown>)
- [func Stop\(\)](<#Stop>)
- [func Wait\(\)](<#Wait>)
- [type Terminator](<#Terminator>)
  - [func Default\(\) \*Terminator](<#Default>)
  - [func New\(\) \*Terminator](<#New>)
  - [func \(t \*Terminator\) Add\(delta int\)](<#Terminator.Add>)
  - [func \(t \*Terminator\) Done\(\)](<#Terminator.Done>)
  - [func \(t \*Terminator\) ShutDown\(\) \<\-chan struct\{\}](<#Terminator.ShutDown>)
  - [func \(t \*Terminator\) ShuttingDown\(\) bool](<#Terminator.ShuttingDown>)
  - [func \(t \*Terminator\) Stop\(\)](<#Terminator.Stop>)
  - [func \(t \*Terminator\) Wait\(\)](<#Terminator.Wait>)


<a name="Add"></a>
## func Add

```go
func Add(delta int)
```

Add adds delta to the count of goroutines in the group

<a name="Done"></a>
## func Done

```go
func Done()
```

Done decrements the count of goroutines in the group by one

<a name="SetDefault"></a>
## func SetDefault

```go
func SetDefault(t *Terminator)
```

SetDefault sets the default Terminator

<a name="ShutDown"></a>
## func ShutDown

```go
func ShutDown() <-chan struct{}
```

ShutDown allows code to wait for a shut down signal

<a name="ShuttingDown"></a>
## func ShuttingDown

```go
func ShuttingDown() bool
```

ShuttingDown returns true if shutdown is in Default\(\).progress

<a name="Stop"></a>
## func Stop

```go
func Stop()
```

Stop signals that all goroutines in the group should safely exit

<a name="Wait"></a>
## func Wait

```go
func Wait()
```

Wait blocks until every goroutines in the group has called Done\(\)

<a name="Terminator"></a>
## type Terminator

Terminator manages groups of goroutines

```go
type Terminator struct {
    // contains filtered or unexported fields
}
```

<a name="Default"></a>
### func Default

```go
func Default() *Terminator
```

Default returns the default [Terminator](<#Terminator>).

<a name="New"></a>
### func New

```go
func New() *Terminator
```

New returns a Terminator

<a name="Terminator.Add"></a>
### func \(\*Terminator\) Add

```go
func (t *Terminator) Add(delta int)
```

Add adds delta to the count of goroutines in the group

<a name="Terminator.Done"></a>
### func \(\*Terminator\) Done

```go
func (t *Terminator) Done()
```

Done decrements the count of goroutines in the group by one

<a name="Terminator.ShutDown"></a>
### func \(\*Terminator\) ShutDown

```go
func (t *Terminator) ShutDown() <-chan struct{}
```

ShutDown allows code to wait for a shut down signal

<a name="Terminator.ShuttingDown"></a>
### func \(\*Terminator\) ShuttingDown

```go
func (t *Terminator) ShuttingDown() bool
```

ShuttingDown returns true if shutdown is in Default\(\).progress

<a name="Terminator.Stop"></a>
### func \(\*Terminator\) Stop

```go
func (t *Terminator) Stop()
```

Stop signals that all goroutines in the group should safely exit

<a name="Terminator.Wait"></a>
### func \(\*Terminator\) Wait

```go
func (t *Terminator) Wait()
```

Wait blocks until every goroutines in the group has called Done\(\)

# test

```go
import "testviper"
```

## Index



# version

```go
import "github.com/bruceesmith/echidna/version"
```

## Index

- [func JSON\(\) \(jason string\)](<#JSON>)
- [func Version\(w ...io.Writer\)](<#Version>)
- [type Info](<#Info>)


<a name="JSON"></a>
## func JSON

```go
func JSON() (jason string)
```

JSON prints detailed version information in JSON format

<a name="Version"></a>
## func Version

```go
func Version(w ...io.Writer)
```

Version prints detailed version information

<a name="Info"></a>
## type Info

Info is facts about how and when the program was compiled including Git details

```go
type Info struct {
    BuildDate  string `json:"build_date,omitempty"`
    Commit     string `json:"vcs_commit,omitempty"`
    CommitDate string `json:"vcs_date,omitempty"`
    Go         string `json:"go,omitempty"`
    Program    string `json:"progra,omitempty"`
    Version    string `json:"version,omitempty"`

    Error string `json:"error,omitempty"`
}
```

# viper

```go
import "github.com/bruceesmith/echidna/viper"
```

## Index

- [func Init\[E any\]\(prog, ver string, config \*E, validate func\(cf \*E\) error, flagfuncs ...func\(\)\) \(err error\)](<#Init>)


<a name="Init"></a>
## func Init

```go
func Init[E any](prog, ver string, config *E, validate func(cf *E) error, flagfuncs ...func()) (err error)
```

Init initialises the echidna package for the use case where the program does not provide and "comamnds" on the command line and it uses the Viper package to handle the configuration

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
