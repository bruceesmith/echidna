# <div align="center">Echidna Library for Go</div>

![background image](echidna.png)

### <a name="top"></a>
### <div align="center">Table of Contents</div>

* [1. Overview](#overview)
* [2. custom](#custom)
* [3. logger](#logger)
* [4. set](#set)
* [5. terminator](#terminator)
* [6. version](#version)
* [7. viper](#viper)

# <a name="overview">1. Overview</a><!-- Code generated by gomarkdoc. DO NOT EDIT -->


```go
import "github.com/bruceesmith/echidna"
```

Package echidna provides helpers for building robust Go daemons and CLIs

Type Terminator permits orderly stopping / shutdown of a group of goroutines via methods which mimic stop of a sync.WaitGroup. There is a default Terminator accessible through top level functions \(Add, Done, Wait and so on\) that call the corresponding Terminator methods.

Another group of functions support logging and tracing. Debug, Error, Info and Warn operate like their package slog equivalents, with the level of logging modifiable using SetLevel. A custom logging level \(LevelTrace\) can be supplied to SetLevel to enable tracing. Tracing can be unconditional when calling Trace, or only enabled for pre\-defined identifiers when calling TraceID. Identifiers for TraceID are registered by calling SetTraceIDs. By default, all debug, error, info and warn messages go to Stdout, and traces go to Stderr; these destinations can be changed by calling RedirectNormal and RedirectTrace respectively.

Type Set defines methods for manipulating a generic set data structure via the expected operations Add, Contains, Intersection, Members, String and Union.

## Index

- [Variables](<#variables>)


## Variables

<a name="Program"></a>

```go
var (
    // Program is the program name
    Program string
    // Version is the program version
    Version string
)
```

<a name="BuildDate"></a>

```go
var (
    // BuildDate is the timestamp for when this program was compiled
    BuildDate string = `Filled in during the build`
    // ErrConfigOK is returned when --checkcfg finds the configuration in good order
    ErrConfigOK = errors.New("configuration is OK")
    // ErrVersion is returned when --version is given
    ErrVersion = errors.New("version requested")
)
```

# cobra

```go
import "github.com/bruceesmith/echidna/cobra"
```

## Index

- [func Init\[E any\]\(prog, ver string, config \*E, short, use string, validate func\(cf \*E\) error, execute func\(\*cobra.Command, \[\]string\) error\) \(err error\)](<#Init>)
- [func Run\(\) \(err error\)](<#Run>)


<a name="Init"></a>
## func [Init](<https://github.com/bruceesmith/echidna/blob/main/cobra/cobra.go#L38>)

```go
func Init[E any](prog, ver string, config *E, short, use string, validate func(cf *E) error, execute func(*cobra.Command, []string) error) (err error)
```

Init initialises the echidna package for the use case where the program defines "commands" using the [github.com/spf13/cobra](<https://pkg.go.dev/github.com/spf13/cobra/>) package.

<a name="Run"></a>
## func [Run](<https://github.com/bruceesmith/echidna/blob/main/cobra/cobra.go#L25>)

```go
func Run() (err error)
```

Run adds all child commands to the root command and sets flags appropriately. This is called by the main program. It only needs to happen once to the rootCmd.

# <a name="custom">2. custom</a>

```go
import "github.com/bruceesmith/echidna/custom"
```

## Index

- [func Init\[E any\]\(prog, ver string, config \*E, unmarshal func\(\[\]byte, \*E\) error, validate func\(cf \*E\) error, flagfuncs ...func\(\)\) \(err error\)](<#Init>)


<a name="Init"></a>
## func [Init](<https://github.com/bruceesmith/echidna/blob/main/custom/custom.go#L24>)

```go
func Init[E any](prog, ver string, config *E, unmarshal func([]byte, *E) error, validate func(cf *E) error, flagfuncs ...func()) (err error)
```

Init initialises the echidna package for the use case where the program does not provide and "comamnds" on the command line and it uses a custom package to handle the configuration

# <a name="logger">3. logger</a>

```go
import "github.com/bruceesmith/echidna/logger"
```

## Index

- [Constants](<#constants>)
- [func Debug\(msg string, args ...any\)](<#Debug>)
- [func Error\(msg string, args ...any\)](<#Error>)
- [func Info\(msg string, args ...any\)](<#Info>)
- [func Level\(\) string](<#Level>)
- [func RedirectStandard\(w io.Writer\)](<#RedirectStandard>)
- [func RedirectTrace\(w io.Writer\)](<#RedirectTrace>)
- [func SetLevel\(l slog.Level\)](<#SetLevel>)
- [func SetTraceIds\(ids ...string\)](<#SetTraceIds>)
- [func Trace\(msg string, args ...any\)](<#Trace>)
- [func TraceID\(id string, msg string, args ...any\)](<#TraceID>)
- [func Warn\(msg string, args ...any\)](<#Warn>)
- [type LogLevel](<#LogLevel>)
  - [func \(ll \*LogLevel\) Set\(ls string\) \(err error\)](<#LogLevel.Set>)
  - [func \(ll \*LogLevel\) String\(\) \(s string\)](<#LogLevel.String>)
  - [func \(ll \*LogLevel\) Type\(\) string](<#LogLevel.Type>)
- [type Traces](<#Traces>)
  - [func \(t \*Traces\) Set\(ts string\) \(err error\)](<#Traces.Set>)
  - [func \(t \*Traces\) String\(\) \(s string\)](<#Traces.String>)
  - [func \(t \*Traces\) Type\(\) string](<#Traces.Type>)


## Constants

<a name="LevelTrace"></a>

```go
const (
    // LevelTrace can be set to enable tracing
    LevelTrace slog.Level = -10
)
```

<a name="Debug"></a>
## func [Debug](<https://github.com/bruceesmith/echidna/blob/main/logger/logger.go#L55>)

```go
func Debug(msg string, args ...any)
```

Debug emits a debug log

<a name="Error"></a>
## func [Error](<https://github.com/bruceesmith/echidna/blob/main/logger/logger.go#L60>)

```go
func Error(msg string, args ...any)
```

Error emits an error log

<a name="Info"></a>
## func [Info](<https://github.com/bruceesmith/echidna/blob/main/logger/logger.go#L65>)

```go
func Info(msg string, args ...any)
```

Info emits an info log

<a name="Level"></a>
## func [Level](<https://github.com/bruceesmith/echidna/blob/main/logger/logger.go#L69>)

```go
func Level() string
```



<a name="RedirectStandard"></a>
## func [RedirectStandard](<https://github.com/bruceesmith/echidna/blob/main/logger/logger.go#L74>)

```go
func RedirectStandard(w io.Writer)
```

RedirectStandard changes the destination for normal \(non\-trace\) logs

<a name="RedirectTrace"></a>
## func [RedirectTrace](<https://github.com/bruceesmith/echidna/blob/main/logger/logger.go#L88>)

```go
func RedirectTrace(w io.Writer)
```

RedirectTrace changes the destination for normal \(non\-trace\) logs

<a name="SetLevel"></a>
## func [SetLevel](<https://github.com/bruceesmith/echidna/blob/main/logger/logger.go#L101>)

```go
func SetLevel(l slog.Level)
```

SetLevel sets the default level of logging

<a name="SetTraceIds"></a>
## func [SetTraceIds](<https://github.com/bruceesmith/echidna/blob/main/logger/logger.go#L106>)

```go
func SetTraceIds(ids ...string)
```

SetTraceIds registers identifiers for future tracing

<a name="Trace"></a>
## func [Trace](<https://github.com/bruceesmith/echidna/blob/main/logger/logger.go#L113>)

```go
func Trace(msg string, args ...any)
```

Trace emits one JSON\-formatted log entry if trace level logging is enabled

<a name="TraceID"></a>
## func [TraceID](<https://github.com/bruceesmith/echidna/blob/main/logger/logger.go#L119>)

```go
func TraceID(id string, msg string, args ...any)
```

TraceID emits one JSON\-formatted log entry if tracing is enabled for the requested ID

<a name="Warn"></a>
## func [Warn](<https://github.com/bruceesmith/echidna/blob/main/logger/logger.go#L129>)

```go
func Warn(msg string, args ...any)
```

Warn emits a warning log

<a name="LogLevel"></a>
## type [LogLevel](<https://github.com/bruceesmith/echidna/blob/main/logger/loglevel.go#L14>)

LogLevel is the level of logging

```go
type LogLevel int
```

<a name="LogLevel.Set"></a>
### func \(\*LogLevel\) [Set](<https://github.com/bruceesmith/echidna/blob/main/logger/loglevel.go#L34>)

```go
func (ll *LogLevel) Set(ls string) (err error)
```

Set is a convenience method for pflag.Value

<a name="LogLevel.String"></a>
### func \(\*LogLevel\) [String](<https://github.com/bruceesmith/echidna/blob/main/logger/loglevel.go#L17>)

```go
func (ll *LogLevel) String() (s string)
```

String is a convenience method for pflag.Value

<a name="LogLevel.Type"></a>
### func \(\*LogLevel\) [Type](<https://github.com/bruceesmith/echidna/blob/main/logger/loglevel.go#L53>)

```go
func (ll *LogLevel) Type() string
```

Type is a conveniene method for pflag.Value

<a name="Traces"></a>
## type [Traces](<https://github.com/bruceesmith/echidna/blob/main/logger/traces.go#L13>)

Traces is the list of trace IDs enabled

```go
type Traces []string
```

<a name="Traces.Set"></a>
### func \(\*Traces\) [Set](<https://github.com/bruceesmith/echidna/blob/main/logger/traces.go#L21>)

```go
func (t *Traces) Set(ts string) (err error)
```

Set is a convenience method for pflag.Value

<a name="Traces.String"></a>
### func \(\*Traces\) [String](<https://github.com/bruceesmith/echidna/blob/main/logger/traces.go#L16>)

```go
func (t *Traces) String() (s string)
```

String is a convenience method for pflag.Value

<a name="Traces.Type"></a>
### func \(\*Traces\) [Type](<https://github.com/bruceesmith/echidna/blob/main/logger/traces.go#L31>)

```go
func (t *Traces) Type() string
```

Type is a conveniene method for pflag.Value

# <a name="set">4. set</a>

```go
import "github.com/bruceesmith/echidna/set"
```

## Index

- [type Set](<#Set>)
  - [func New\[E comparable\]\(vals ...E\) \*Set\[E\]](<#New>)
  - [func \(s \*Set\[E\]\) Add\(vals ...E\)](<#Set[E].Add>)
  - [func \(s \*Set\[E\]\) Contains\(v E\) bool](<#Set[E].Contains>)
  - [func \(s \*Set\[E\]\) Intersection\(s2 \*Set\[E\]\) \*Set\[E\]](<#Set[E].Intersection>)
  - [func \(s \*Set\[E\]\) Members\(\) \[\]E](<#Set[E].Members>)
  - [func \(s \*Set\[E\]\) String\(\) string](<#Set[E].String>)
  - [func \(s \*Set\[E\]\) Union\(s2 \*Set\[E\]\) \*Set\[E\]](<#Set[E].Union>)


<a name="Set"></a>
## type [Set](<https://github.com/bruceesmith/echidna/blob/main/set/set.go#L17-L20>)

Set is a generics implementation of the set data type

```go
type Set[E comparable] struct {
    // contains filtered or unexported fields
}
```

<a name="New"></a>
### func [New](<https://github.com/bruceesmith/echidna/blob/main/set/set.go#L23>)

```go
func New[E comparable](vals ...E) *Set[E]
```

New creates a new Set

<a name="Set[E].Add"></a>
### func \(\*Set\[E\]\) [Add](<https://github.com/bruceesmith/echidna/blob/main/set/set.go#L34>)

```go
func (s *Set[E]) Add(vals ...E)
```

Add puts a new value into a Set

<a name="Set[E].Contains"></a>
### func \(\*Set\[E\]\) [Contains](<https://github.com/bruceesmith/echidna/blob/main/set/set.go#L43>)

```go
func (s *Set[E]) Contains(v E) bool
```

Contains checks if a value is in the Set

<a name="Set[E].Intersection"></a>
### func \(\*Set\[E\]\) [Intersection](<https://github.com/bruceesmith/echidna/blob/main/set/set.go#L51>)

```go
func (s *Set[E]) Intersection(s2 *Set[E]) *Set[E]
```

Intersection returns the logical intersection of 2 Sets

<a name="Set[E].Members"></a>
### func \(\*Set\[E\]\) [Members](<https://github.com/bruceesmith/echidna/blob/main/set/set.go#L66>)

```go
func (s *Set[E]) Members() []E
```

Members returns a slice of the values in a Set

<a name="Set[E].String"></a>
### func \(\*Set\[E\]\) [String](<https://github.com/bruceesmith/echidna/blob/main/set/set.go#L77>)

```go
func (s *Set[E]) String() string
```

String returns a string representation of the Set members

<a name="Set[E].Union"></a>
### func \(\*Set\[E\]\) [Union](<https://github.com/bruceesmith/echidna/blob/main/set/set.go#L82>)

```go
func (s *Set[E]) Union(s2 *Set[E]) *Set[E]
```

Union returns the logical union of 2 Sets

# <a name="terminator">5. terminator</a>

```go
import "github.com/bruceesmith/echidna/terminator"
```

## Index

- [func Add\(delta int\)](<#Add>)
- [func Done\(\)](<#Done>)
- [func SetDefault\(t \*Terminator\)](<#SetDefault>)
- [func ShutDown\(\) \<\-chan struct\{\}](<#ShutDown>)
- [func ShuttingDown\(\) bool](<#ShuttingDown>)
- [func Stop\(\)](<#Stop>)
- [func Wait\(\)](<#Wait>)
- [type Terminator](<#Terminator>)
  - [func Default\(\) \*Terminator](<#Default>)
  - [func New\(\) \*Terminator](<#New>)
  - [func \(t \*Terminator\) Add\(delta int\)](<#Terminator.Add>)
  - [func \(t \*Terminator\) Done\(\)](<#Terminator.Done>)
  - [func \(t \*Terminator\) ShutDown\(\) \<\-chan struct\{\}](<#Terminator.ShutDown>)
  - [func \(t \*Terminator\) ShuttingDown\(\) bool](<#Terminator.ShuttingDown>)
  - [func \(t \*Terminator\) Stop\(\)](<#Terminator.Stop>)
  - [func \(t \*Terminator\) Wait\(\)](<#Terminator.Wait>)


<a name="Add"></a>
## func [Add](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L43>)

```go
func Add(delta int)
```

Add adds delta to the count of goroutines in the group

<a name="Done"></a>
## func [Done](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L51>)

```go
func Done()
```

Done decrements the count of goroutines in the group by one

<a name="SetDefault"></a>
## func [SetDefault](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L61>)

```go
func SetDefault(t *Terminator)
```

SetDefault sets the default Terminator

<a name="ShutDown"></a>
## func [ShutDown](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L56>)

```go
func ShutDown() <-chan struct{}
```

ShutDown allows code to wait for a shut down signal

<a name="ShuttingDown"></a>
## func [ShuttingDown](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L66>)

```go
func ShuttingDown() bool
```

ShuttingDown returns true if shutdown is in Default\(\).progress

<a name="Stop"></a>
## func [Stop](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L71>)

```go
func Stop()
```

Stop signals that all goroutines in the group should safely exit

<a name="Wait"></a>
## func [Wait](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L77>)

```go
func Wait()
```

Wait blocks until every goroutines in the group has called Done\(\)

<a name="Terminator"></a>
## type [Terminator](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L16-L20>)

Terminator manages groups of goroutines

```go
type Terminator struct {
    // contains filtered or unexported fields
}
```

<a name="Default"></a>
### func [Default](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L48>)

```go
func Default() *Terminator
```

Default returns the default [Terminator](<#Terminator>).

<a name="New"></a>
### func [New](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L82>)

```go
func New() *Terminator
```

New returns a Terminator

<a name="Terminator.Add"></a>
### func \(\*Terminator\) [Add](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L89>)

```go
func (t *Terminator) Add(delta int)
```

Add adds delta to the count of goroutines in the group

<a name="Terminator.Done"></a>
### func \(\*Terminator\) [Done](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L94>)

```go
func (t *Terminator) Done()
```

Done decrements the count of goroutines in the group by one

<a name="Terminator.ShutDown"></a>
### func \(\*Terminator\) [ShutDown](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L99>)

```go
func (t *Terminator) ShutDown() <-chan struct{}
```

ShutDown allows code to wait for a shut down signal

<a name="Terminator.ShuttingDown"></a>
### func \(\*Terminator\) [ShuttingDown](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L104>)

```go
func (t *Terminator) ShuttingDown() bool
```

ShuttingDown returns true if shutdown is in Default\(\).progress

<a name="Terminator.Stop"></a>
### func \(\*Terminator\) [Stop](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L109>)

```go
func (t *Terminator) Stop()
```

Stop signals that all goroutines in the group should safely exit

<a name="Terminator.Wait"></a>
### func \(\*Terminator\) [Wait](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L115>)

```go
func (t *Terminator) Wait()
```

Wait blocks until every goroutines in the group has called Done\(\)

# testcobra

```go
import "testcobra"
```

## Index



# testcustom

```go
import "testviper"
```

## Index



# testviper

```go
import "testviper"
```

## Index



# <a name="version">6. version</a>

```go
import "github.com/bruceesmith/echidna/version"
```

Package version supports either printing or return of information concerning the compiled CLI or daemon.

[Print](<#Print>) writes a text version of [Info](<#Info>) to [os.Stdout](<https://pkg.go.dev/os/#Stdout>) by default. \- if jason is true, the output is indented JSON instead of text \- if an optional [io.Writer](<https://pkg.go.dev/io/#Writer>) is supplied the output is written using that [io.Writer](<https://pkg.go.dev/io/#Writer>).

Alternatively, [Version](<#Version>) returns an [Info](<#Info>) struct

Examples:

```
// Print version information to stdout as human readable text
version.Print(false)

// Print version information to stdout as indented JSON
version.Print(true)

// Print version information into a bytes.Buffer
b := bytes.NewBufferString("")
version.Print(false, b)
fmt.Println(b.String())

// Return the version information as an Info struct
info := version.Version()
if err != nil {
	panic(err)
}
fmt.Printf("%v\n", v)
```

## Index

- [func Print\(jason bool, w ...io.Writer\)](<#Print>)
- [type Info](<#Info>)
  - [func Version\(\) Info](<#Version>)


<a name="Print"></a>
## func [Print](<https://github.com/bruceesmith/echidna/blob/main/version/version.go#L81>)

```go
func Print(jason bool, w ...io.Writer)
```

Print prints detailed version information

<a name="Info"></a>
## type [Info](<https://github.com/bruceesmith/echidna/blob/main/version/version.go#L49-L58>)

Info is facts about how and when the program was compiled including Git details

```go
type Info struct {
    BuildDate  string `json:"build_date,omitempty"`
    Commit     string `json:"vcs_commit,omitempty"`
    CommitDate string `json:"vcs_date,omitempty"`
    Go         string `json:"go,omitempty"`
    Program    string `json:"program,omitempty"`
    Version    string `json:"version,omitempty"`

    Error string `json:"error,omitempty"`
}
```

<a name="Version"></a>
### func [Version](<https://github.com/bruceesmith/echidna/blob/main/version/version.go#L108>)

```go
func Version() Info
```

Version returns detailed version information

# vpr

```go
import "github.com/bruceesmith/echidna/vpr"
```

## Index

- [func Init\[E any\]\(prog, ver string, config \*E, envPrefix string, validate func\(cf \*E\) error, flagfuncs ...func\(\)\) \(err error\)](<#Init>)


<a name="Init"></a>
## func [Init](<https://github.com/bruceesmith/echidna/blob/main/vpr/vpr.go#L24>)

```go
func Init[E any](prog, ver string, config *E, envPrefix string, validate func(cf *E) error, flagfuncs ...func()) (err error)
```

Init initialises the echidna package for the use case where the program does not provide and "comamnds" on the command line and it uses the Viper package to handle the configuration

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
