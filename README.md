[![Go Reference][goreference_badge]][goreference_link]
[![Go Report Card][goreportcard_badge]][goreportcard_link]
 
# <div align="center">Echidna Library for Go</div>
 
![background image](echidna.png)
 
<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# echidna

```go
import "github.com/bruceesmith/echidna"
```

Package echidna builds upon the Github packages [knadh/koanf](<https://github.com/knadh/koanf>), [urfave/cli/v3](<https://github.com/urfave/cli>), [bruceesmith/sflags](<https://github.com/urfave/sflags>) to make it extremely simple to use the features of these excellent packages in concert.

Every program using echidna will expose a standard set of command\-line flags \(\-\-json, \-\-log, \-\-trace, \-\-verbose\) in addition to the standard flags provided by urfave/cli/v3 \(\-\-help and \-\-version\).

If a configuration struct is provided to [Run](<#Run>) function by [Configuration](<#Configuration>), then a further command\-line flag \(\-\-config\) is added to provide the source\(s\) of values for fields in the struct.

Command\-line flags bound to fields in the configuration are created by providing [ConfigFlags](<#ConfigFlags>) to [Run](<#Run>). These flags can be bound either to the root command or to one or more child commands.

## Index

- [Variables](<#variables>)
- [func Run\(ctx context.Context, command \*cli.Command, options ...Option\)](<#Run>)
- [type Configurator](<#Configurator>)
- [type FlagOption](<#FlagOption>)
  - [func DescTag\(tag string\) FlagOption](<#DescTag>)
  - [func EnvDivider\(divider string\) FlagOption](<#EnvDivider>)
  - [func EnvPrefix\(prefix string\) FlagOption](<#EnvPrefix>)
  - [func FlagDivider\(divider string\) FlagOption](<#FlagDivider>)
  - [func FlagTag\(tag string\) FlagOption](<#FlagTag>)
  - [func Flatten\(flatten bool\) FlagOption](<#Flatten>)
  - [func Prefix\(prefix string\) FlagOption](<#Prefix>)
  - [func Validator\(val sflags.ValidateFunc\) FlagOption](<#Validator>)
- [type Loader](<#Loader>)
- [type Option](<#Option>)
  - [func ConfigFlags\(configs \[\]Configurator, command \*cli.Command, ops ...FlagOption\) Option](<#ConfigFlags>)
  - [func Configuration\(config Configurator, loaders \[\]Loader\) Option](<#Configuration>)
  - [func NoDefaultFlags\(\) Option](<#NoDefaultFlags>)
  - [func NoJSON\(\) Option](<#NoJSON>)
  - [func NoLog\(\) Option](<#NoLog>)
  - [func NoTrace\(\) Option](<#NoTrace>)
  - [func NoVerbose\(\) Option](<#NoVerbose>)


## Variables

<a name="BuildDate"></a>

```go
var (
    // BuildDate is the timestamp for when this program was compiled
    BuildDate string = `Filled in during the build`
)
```

<a name="Run"></a>
## func [Run](<https://github.com/bruceesmith/echidna/blob/main/echidna.go#L442>)

```go
func Run(ctx context.Context, command *cli.Command, options ...Option)
```

Run is the primary external function of this library. It augments the cli.Command with default command\-line flags, hooks in handling for processing a configuration, runs the appropriate Action, calls the terminator to wait for goroutine cleanup

<details><summary>Example (Action)</summary>
<p>



```go
// Include an Action function
//
var cmd = &cli.Command{
	Action: func(ctx context.Context, cmd *cli.Command) error {
		fmt.Println("hello")
		return nil
	},
	Name:    "runaction",
	Version: "1",
}
os.Args = []string{"runaction"}
Run(context.Background(), cmd)
// Output:
// hello
```

#### Output

```
hello
```

</p>
</details>

<details><summary>Example (Basic)</summary>
<p>



```go
// The most basic example
//
var cmd = &cli.Command{
	Name: "runbasic",
	Action: func(ctx context.Context, cmd *cli.Command) error {
		return nil
	},
}
os.Args = []string{"runbasic", "h"}
Run(context.Background(), cmd, NoDefaultFlags())
// Output:
// NAME:
//    runbasic - A new cli application
//
// USAGE:
//    runbasic [global options] [command [command options]]
//
// COMMANDS:
//    version, v  print the version
//    help, h     Shows a list of commands or help for one command
//
// GLOBAL OPTIONS:
//    --help, -h  show help
```

#### Output

```
NAME:
   runbasic - A new cli application

USAGE:
   runbasic [global options] [command [command options]]

COMMANDS:
   version, v  print the version
   help, h     Shows a list of commands or help for one command

GLOBAL OPTIONS:
   --help, -h  show help
```

</p>
</details>

<details><summary>Example (Customflag)</summary>
<p>



```go
// Include a custom flag
//
var cmd = &cli.Command{
	Action: func(ctx context.Context, cmd *cli.Command) error {
		fmt.Println("hello", cmd.Int("i"))
		return nil
	},
	Flags: []cli.Flag{
		&cli.IntFlag{
			Name:  "i",
			Usage: "An integer",
		},
	},
	Name:    "runcustomflag",
	Version: "1",
}
os.Args = []string{"runcustomflag", "-i", "22"}
Run(context.Background(), cmd, NoDefaultFlags())
// Output:
// hello 22
```

#### Output

```
hello 22
```

</p>
</details>

<details><summary>Example (Flagwithdefault)</summary>
<p>



```go
// Include a custom flag with a default value
//
var cmd = &cli.Command{
	Action: func(ctx context.Context, cmd *cli.Command) error {
		fmt.Println("hello")
		return nil
	},
	Flags: []cli.Flag{
		&cli.IntFlag{
			Name:  "i",
			Usage: "An integer",
			Value: 22,
		},
	},
	Name:    "runflagwithdefault",
	Version: "1",
}
os.Args = []string{"runflagwithdefault", "--help"}
Run(context.Background(), cmd, NoDefaultFlags())
// Output:
// NAME:
//    runflagwithdefault - A new cli application
//
// USAGE:
//    runflagwithdefault [global options] [command [command options]]
//
// VERSION:
//    1
//
// COMMANDS:
//    version, v  print the version
//    help, h     Shows a list of commands or help for one command
//
// GLOBAL OPTIONS:
//    -i value       An integer (default: 22)
//    --help, -h     show help
//    --version, -v  print the version
```

#### Output

```
NAME:
   runflagwithdefault - A new cli application

USAGE:
   runflagwithdefault [global options] [command [command options]]

VERSION:
   1

COMMANDS:
   version, v  print the version
   help, h     Shows a list of commands or help for one command

GLOBAL OPTIONS:
   -i value       An integer (default: 22)
   --help, -h     show help
   --version, -v  print the version
```

</p>
</details>

<details><summary>Example (Version)</summary>
<p>



```go
// Include a Version field in the Command
//
var cmd = &cli.Command{
	Name: "runversion",
	Action: func(ctx context.Context, cmd *cli.Command) error {
		return nil
	},
	Version: "1",
}
os.Args = []string{"runversion", "h"}
Run(context.Background(), cmd, NoDefaultFlags())
// Output:
// NAME:
//    runversion - A new cli application
//
// USAGE:
//    runversion [global options] [command [command options]]
//
// VERSION:
//    1
//
// COMMANDS:
//    version, v  print the version
//    help, h     Shows a list of commands or help for one command
//
// GLOBAL OPTIONS:
//    --help, -h     show help
//    --version, -v  print the version
```

#### Output

```
NAME:
   runversion - A new cli application

USAGE:
   runversion [global options] [command [command options]]

VERSION:
   1

COMMANDS:
   version, v  print the version
   help, h     Shows a list of commands or help for one command

GLOBAL OPTIONS:
   --help, -h     show help
   --version, -v  print the version
```

</p>
</details>

<a name="Configurator"></a>
## type [Configurator](<https://github.com/bruceesmith/echidna/blob/main/echidna.go#L45-L47>)

Configurator is the interface for a configuration struct

```go
type Configurator interface {
    Validate() error
}
```

<a name="FlagOption"></a>
## type [FlagOption](<https://github.com/bruceesmith/echidna/blob/main/config_flags.go#L44>)

FlagOption is a functional option parameter for the ConfigFlags function

```go
type FlagOption func()
```

<a name="DescTag"></a>
### func [DescTag](<https://github.com/bruceesmith/echidna/blob/main/config_flags.go#L67>)

```go
func DescTag(tag string) FlagOption
```

DescTag sets the struct tag where usage text is configured

<a name="EnvDivider"></a>
### func [EnvDivider](<https://github.com/bruceesmith/echidna/blob/main/config_flags.go#L75>)

```go
func EnvDivider(divider string) FlagOption
```

EnvDivider is the character in between parts of an environment variable bound to a command line struct\-bound flag

<a name="EnvPrefix"></a>
### func [EnvPrefix](<https://github.com/bruceesmith/echidna/blob/main/config_flags.go#L83>)

```go
func EnvPrefix(prefix string) FlagOption
```

EnvPrefix is an optional prefix for an environment variable bound to a command line struct\-bound flag

<a name="FlagDivider"></a>
### func [FlagDivider](<https://github.com/bruceesmith/echidna/blob/main/config_flags.go#L91>)

```go
func FlagDivider(divider string) FlagOption
```

FlagDivider is the character in between parts of a struct\-bound command line flag's name

<a name="FlagTag"></a>
### func [FlagTag](<https://github.com/bruceesmith/echidna/blob/main/config_flags.go#L99>)

```go
func FlagTag(tag string) FlagOption
```

FlagTag is the struct tag used to configure struct\-bound command line flags

<a name="Flatten"></a>
### func [Flatten](<https://github.com/bruceesmith/echidna/blob/main/config_flags.go#L107>)

```go
func Flatten(flatten bool) FlagOption
```

Flatten determines the name of a command line flag bound to a an anonymous struct field

<a name="Prefix"></a>
### func [Prefix](<https://github.com/bruceesmith/echidna/blob/main/config_flags.go#L115>)

```go
func Prefix(prefix string) FlagOption
```

Prefix is an optional prefix for the names of all struct\-bound command line flags

<a name="Validator"></a>
### func [Validator](<https://github.com/bruceesmith/echidna/blob/main/config_flags.go#L123>)

```go
func Validator(val sflags.ValidateFunc) FlagOption
```

Validator is an optional function that will be called to to validate each struct\-field bound flag

<a name="Loader"></a>
## type [Loader](<https://github.com/bruceesmith/echidna/blob/main/echidna.go#L59-L63>)

Loader is a parameter to [Configuration](<#Configuration>) which determines how configuration sources are loaded into the confguration struct

```go
type Loader struct {
    Provider func(string) koanf.Provider
    Parser   koanf.Parser
    Match    func(string) bool
}
```

<a name="Option"></a>
## type [Option](<https://github.com/bruceesmith/echidna/blob/main/echidna.go#L66>)

Option is a functional parameter for Run\(\)

```go
type Option func() error
```

<a name="ConfigFlags"></a>
### func [ConfigFlags](<https://github.com/bruceesmith/echidna/blob/main/config_flags.go#L132>)

```go
func ConfigFlags(configs []Configurator, command *cli.Command, ops ...FlagOption) Option
```

ConfigFlags creates and configures [Run](<#Run>) to have command line flags bound to the fields of one or more parts of a configuration struct

<details><summary>Example (Basic Flag Override)</summary>
<p>



```go
// Flags bound to fields in a configuration struct. The flag value
// overrides the field's value obtained from reading the  YAML
// configuration file
//
// test.yml simply contains:
// i: 33
//
var (
	cfg configExample
	cmd = &cli.Command{
		Action: func(ctx context.Context, cmd *cli.Command) error {
			fmt.Println("config is", cfg)
			return nil
		},
		Name:    "basicflagoverride",
		Version: "1",
	}
	loaders = []Loader{
		{
			Provider: func(s string) koanf.Provider {
				return file.Provider(s)
			},
			Parser: yaml.Parser(),
			Match: func(s string) bool {
				return strings.HasSuffix(s, ".yml")
			},
		},
	}
)
os.Args = []string{"basicflagoverride", "-i", "77", "--config", "testdata/test.yml"}
Run(
	context.Background(),
	cmd,
	Configuration(
		&cfg,
		loaders,
	),
	ConfigFlags(
		[]Configurator{&cfg},
		cmd,
	),
	NoDefaultFlags(),
)
// Output:
// config is {77}
```

#### Output

```
config is {77}
```

</p>
</details>

<details><summary>Example (Basic Help)</summary>
<p>



```go
// Help for flags bound to fields in a configuration struct. This
// shows the flag "--i" bound to cfg.I
//
var (
	cfg configExample
	cmd = &cli.Command{
		Action: func(ctx context.Context, cmd *cli.Command) error {
			fmt.Println("config is", cfg)
			return nil
		},
		Name:    "basichelp",
		Version: "1",
	}
	loaders = []Loader{
		{
			Provider: func(s string) koanf.Provider {
				return file.Provider(s)
			},
			Parser: yaml.Parser(),
			Match: func(s string) bool {
				return strings.HasSuffix(s, ".yml")
			},
		},
	}
)
os.Args = []string{"basichelp", "--help"}
Run(
	context.Background(),
	cmd,
	Configuration(
		&cfg,
		loaders,
	),
	ConfigFlags(
		[]Configurator{&cfg},
		cmd,
	),
	NoDefaultFlags(),
)
// Output:
// NAME:
//    basichelp - A new cli application
//
// USAGE:
//    basichelp [global options] [command [command options]]
//
// VERSION:
//    1
//
// COMMANDS:
//    version, v  print the version
//    help, h     Shows a list of commands or help for one command
//
// GLOBAL OPTIONS:
//    -i value                                                     (default: 0) [$I]
//    --config value, --cfg value [ --config value, --cfg value ]  comma-separated list of path(s) to configuration file(s)
//    --help, -h                                                   show help
//    --version, -v                                                print the version
```

#### Output

```
NAME:
   basichelp - A new cli application

USAGE:
   basichelp [global options] [command [command options]]

VERSION:
   1

COMMANDS:
   version, v  print the version
   help, h     Shows a list of commands or help for one command

GLOBAL OPTIONS:
   -i value                                                     (default: 0) [$I]
   --config value, --cfg value [ --config value, --cfg value ]  comma-separated list of path(s) to configuration file(s)
   --help, -h                                                   show help
   --version, -v                                                print the version
```

</p>
</details>

<a name="Configuration"></a>
### func [Configuration](<https://github.com/bruceesmith/echidna/blob/main/echidna.go#L248>)

```go
func Configuration(config Configurator, loaders []Loader) Option
```

Configuration is an Option helper to define a configuration structure that will be populated from the sources given on a \-\-config command\-line flag

<details><summary>Example (Basic)</summary>
<p>



```go
var (
	cfg configExample
	cmd = &cli.Command{
		Action: func(ctx context.Context, cmd *cli.Command) error {
			fmt.Println("config is", cfg)
			return nil
		},
		Name:    "configbasic",
		Version: "1",
	}
	loaders = []Loader{
		{
			Provider: func(s string) koanf.Provider {
				return file.Provider(s)
			},
			Parser: yaml.Parser(),
			Match: func(s string) bool {
				return strings.HasSuffix(s, ".yml")
			},
		},
	}
)
os.Args = []string{"configbasic", "--config", "testdata/test.yml"}
Run(
	context.Background(),
	cmd,
	Configuration(
		&cfg,
		loaders,
	),
	NoDefaultFlags(),
)
// Output:
// config is {33}
```

#### Output

```
config is {33}
```

</p>
</details>

<a name="NoDefaultFlags"></a>
### func [NoDefaultFlags](<https://github.com/bruceesmith/echidna/blob/main/echidna.go#L504>)

```go
func NoDefaultFlags() Option
```

NoDefaultFlags is a convenience function which is equivalent to calling all of NoJSON, NoLog, NoTrace, and NoVerbose

<a name="NoJSON"></a>
### func [NoJSON](<https://github.com/bruceesmith/echidna/blob/main/echidna.go#L515>)

```go
func NoJSON() Option
```

NoJSON removes the default flag \-\-json

<a name="NoLog"></a>
### func [NoLog](<https://github.com/bruceesmith/echidna/blob/main/echidna.go#L523>)

```go
func NoLog() Option
```

NoLog removes the default flag \-\-log

<a name="NoTrace"></a>
### func [NoTrace](<https://github.com/bruceesmith/echidna/blob/main/echidna.go#L531>)

```go
func NoTrace() Option
```

NoTrace removes the default flag \-\-trace

<a name="NoVerbose"></a>
### func [NoVerbose](<https://github.com/bruceesmith/echidna/blob/main/echidna.go#L539>)

```go
func NoVerbose() Option
```

NoVerbose removes the default flag \-\-verbose

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
 
[goreference_badge]: https://pkg.go.dev/badge/github.com/bruceesmith/echidna/v3.svg
[goreference_link]: https://pkg.go.dev/github.com/bruceesmith/echidna
[goreportcard_badge]: https://goreportcard.com/badge/github.com/bruceesmith/echidna
[goreportcard_link]: https://goreportcard.com/report/github.com/bruceesmith/echidna
