[![Go Reference][goreference_badge]][goreference_link]
[![Go Report Card][goreportcard_badge]][goreportcard_link]

# <div align="center">Echidna Library for Go</div>

![background image](echidna.png)

WARNING: this library is under heavy development, hence the API is subject to
change

### <a name="top"></a>
### <div align="center">Table of Contents</div>

* [1. Overview](#overview)
* [2. program](#programme)
* [3. terminator](#terminator)

# <a name="overview">1. Overview</a>

[goreference_badge]: https://pkg.go.dev/badge/github.com/bruceesmith/echidna/v3.svg
[goreference_link]: https://pkg.go.dev/github.com/bruceesmith/echidna
[goreportcard_badge]: https://goreportcard.com/badge/github.com/bruceesmith/echidna
[goreportcard_link]: https://goreportcard.com/report/github.com/bruceesmith/echidna
<!-- Code generated by gomarkdoc. DO NOT EDIT -->


```go
import "github.com/bruceesmith/echidna"
```

Package echidna provides sub\-packages for building robust Go daemons and CLIs

- program builds upon the Github packages [knadh/koanf](<https://github.com/knadh/koanf>) and [urfave/cli/v3](<https://github.com/urfave/cli>) to make it extremely simple to use the features of those two excellent packages in concert.

- terminator permits orderly stopping / shutdown of a group of goroutines via methods which mimic a [sync.WaitGroup](<https://pkg.go.dev/sync/#WaitGroup>). There is a default \[terminator.Terminator\] accessible through top level functions \(Add, Done, Wait and so on\) that call the corresponding Terminator methods.

Refer to the documentation for the individual packages for more details.

## Index

- [Variables](<#variables>)


## Variables

<a name="BuildDate"></a>

```go
var (
    // BuildDate is the timestamp for when this program was compiled
    BuildDate string = `Filled in during the build`
)
```

# <a name="programme">4. program</a>

```go
import "github.com/bruceesmith/echidna/program"
```

Package program builds upon the Github packages knadh/koanf and urfave/cli/v3 to make it extremely simple to use the features of those two excellent packages in concert.

Every program using program will expose a standard set of command\-line flags \(\-\-json, \-\-log, \-\-trace, \-\-verbose\) in addition to the standard flags provided by urfave/cli/v3 \(\-\-help and \-\-version\).

If a configuration struct is provided to the Run\(\) function, then a further command=line flag \(\-\-config\) is added to provide the source\(s\) of values for fields in the struct.

<details><summary>Example (Action)</summary>
<p>



```go
// Include an Action function
(&cli.Command{
	Action: func(ctx context.Context, cmd *cli.Command) error {
		fmt.Println("hello")
		return nil
	},
	Name:    "action",
	Version: "1",
}).Run(context.Background(), []string{"action"})
// Output:
// hello
```

#### Output

```
hello
```

</p>
</details>

<details><summary>Example (Basic)</summary>
<p>



```go
// The most basic example of urfave/cli/v3
(&cli.Command{Name: "basic"}).Run(context.Background(), os.Args)
// Output:
// NAME:
//    basic - A new cli application
//
// USAGE:
//    basic [global options]
//
// GLOBAL OPTIONS:
//    --help, -h  show help
```

#### Output

```
NAME:
   basic - A new cli application

USAGE:
   basic [global options]

GLOBAL OPTIONS:
   --help, -h  show help
```

</p>
</details>

<details><summary>Example (Flag1)</summary>
<p>



```go
// Include a custom flag
(&cli.Command{
	Action: func(ctx context.Context, cmd *cli.Command) error {
		fmt.Println("hello")
		return nil
	},
	Flags: []cli.Flag{
		&cli.IntFlag{
			Name:  "i",
			Usage: "An integer",
		},
	},
	Name:    "action",
	Version: "1",
}).Run(context.Background(), []string{"action"})
// Output:
// hello
```

#### Output

```
hello
```

</p>
</details>

<details><summary>Example (Flag2)</summary>
<p>



```go
// Include a custom flag
(&cli.Command{
	Action: func(ctx context.Context, cmd *cli.Command) error {
		fmt.Println("hello")
		return nil
	},
	Flags: []cli.Flag{
		&cli.IntFlag{
			Name:  "i",
			Usage: "An integer",
			Value: 22,
		},
	},
	Name:    "action",
	Version: "1",
}).Run(context.Background(), []string{"action", "--help"})
// Output:
// NAME:
//    action - A new cli application
//
// USAGE:
//    action [global options]
//
// VERSION:
//    1
//
// GLOBAL OPTIONS:
//    -i value       An integer (default: 22)
//    --help, -h     show help
//    --version, -v  print the version
```

#### Output

```
NAME:
   action - A new cli application

USAGE:
   action [global options]

VERSION:
   1

GLOBAL OPTIONS:
   -i value       An integer (default: 22)
   --help, -h     show help
   --version, -v  print the version
```

</p>
</details>

<details><summary>Example (Version)</summary>
<p>



```go
// Include a Version field in the Command
(&cli.Command{
	Name:    "version",
	Version: "1",
}).Run(context.Background(), os.Args)
// Output:
// NAME:
//    version - A new cli application
//
// USAGE:
//    version [global options]
//
// VERSION:
//    1
//
// GLOBAL OPTIONS:
//    --help, -h     show help
//    --version, -v  print the version
```

#### Output

```
NAME:
   version - A new cli application

USAGE:
   version [global options]

VERSION:
   1

GLOBAL OPTIONS:
   --help, -h     show help
   --version, -v  print the version
```

</p>
</details>

## Index

- [func Run\(ctx context.Context, command \*cli.Command, options ...Option\)](<#Run>)
- [type Configurator](<#Configurator>)
- [type FlagOption](<#FlagOption>)
  - [func DescTag\(tag string\) FlagOption](<#DescTag>)
  - [func EnvDivider\(divider string\) FlagOption](<#EnvDivider>)
  - [func EnvPrefix\(prefix string\) FlagOption](<#EnvPrefix>)
  - [func FlagDivider\(divider string\) FlagOption](<#FlagDivider>)
  - [func FlagTag\(tag string\) FlagOption](<#FlagTag>)
  - [func Flatten\(flatten bool\) FlagOption](<#Flatten>)
  - [func Prefix\(prefix string\) FlagOption](<#Prefix>)
  - [func Validator\(val sflags.ValidateFunc\) FlagOption](<#Validator>)
- [type Option](<#Option>)
  - [func ConfigFlags\(configs \[\]Configurator, command \*cli.Command, ops ...FlagOption\) Option](<#ConfigFlags>)
  - [func Configuration\(config Configurator\) Option](<#Configuration>)
  - [func NoDefaultFlags\(\) Option](<#NoDefaultFlags>)
  - [func NoJSON\(\) Option](<#NoJSON>)
  - [func NoLog\(\) Option](<#NoLog>)
  - [func NoTrace\(\) Option](<#NoTrace>)
  - [func NoVerbose\(\) Option](<#NoVerbose>)


<a name="Run"></a>
## func [Run](<https://github.com/bruceesmith/echidna/blob/main/program/program.go#L401>)

```go
func Run(ctx context.Context, command *cli.Command, options ...Option)
```

Run is the primary external function of this library. It augments the cli.Command with default command\-line flags, hooks in handling for processing a configuration, runs the appropriate Action, calls the terminator to wait for goroutine cleanup

<a name="Configurator"></a>
## type [Configurator](<https://github.com/bruceesmith/echidna/blob/main/program/program.go#L38-L40>)

Configurator is the interface for a configuration struct

```go
type Configurator interface {
    Validate() error
}
```

<a name="FlagOption"></a>
## type [FlagOption](<https://github.com/bruceesmith/echidna/blob/main/program/config_flags.go#L43>)

FlagOption is a functional option parameter for the ConfigFlags function

```go
type FlagOption func()
```

<a name="DescTag"></a>
### func [DescTag](<https://github.com/bruceesmith/echidna/blob/main/program/config_flags.go#L66>)

```go
func DescTag(tag string) FlagOption
```

DescTag sets the struct tag where usage text is configured

<a name="EnvDivider"></a>
### func [EnvDivider](<https://github.com/bruceesmith/echidna/blob/main/program/config_flags.go#L74>)

```go
func EnvDivider(divider string) FlagOption
```

EnvDivider is the character in between parts of an environment variable bound to a command line struct\-bound flag

<a name="EnvPrefix"></a>
### func [EnvPrefix](<https://github.com/bruceesmith/echidna/blob/main/program/config_flags.go#L82>)

```go
func EnvPrefix(prefix string) FlagOption
```

EnvPrefix is an optional prefix for an environment variable bound to a command line struct\-bound flag

<a name="FlagDivider"></a>
### func [FlagDivider](<https://github.com/bruceesmith/echidna/blob/main/program/config_flags.go#L90>)

```go
func FlagDivider(divider string) FlagOption
```

FlagDivider is the character in between parts of a struct\-bound command line flag's name

<a name="FlagTag"></a>
### func [FlagTag](<https://github.com/bruceesmith/echidna/blob/main/program/config_flags.go#L98>)

```go
func FlagTag(tag string) FlagOption
```

FlagTag is the struct tag used to configure struct\-bound command line flags

<a name="Flatten"></a>
### func [Flatten](<https://github.com/bruceesmith/echidna/blob/main/program/config_flags.go#L106>)

```go
func Flatten(flatten bool) FlagOption
```

Flatten determines the name of a command line flag bound to a an anonymous struct field

<a name="Prefix"></a>
### func [Prefix](<https://github.com/bruceesmith/echidna/blob/main/program/config_flags.go#L114>)

```go
func Prefix(prefix string) FlagOption
```

Prefix is an optional prefix for the names of all struct\-bound command line flags

<a name="Validator"></a>
### func [Validator](<https://github.com/bruceesmith/echidna/blob/main/program/config_flags.go#L122>)

```go
func Validator(val sflags.ValidateFunc) FlagOption
```

Validator is an optional function that will be called to to validate each struct\-field bound flag

<a name="Option"></a>
## type [Option](<https://github.com/bruceesmith/echidna/blob/main/program/program.go#L50>)

Option is a functional parameter for Run\(\)

```go
type Option func(params ...any) error
```

<a name="ConfigFlags"></a>
### func [ConfigFlags](<https://github.com/bruceesmith/echidna/blob/main/program/config_flags.go#L131>)

```go
func ConfigFlags(configs []Configurator, command *cli.Command, ops ...FlagOption) Option
```

ConfigFlags creates and configures [program.Run](<#Run>) to have command line flags bound to the fields of one or more parts of a configuration struct

<a name="Configuration"></a>
### func [Configuration](<https://github.com/bruceesmith/echidna/blob/main/program/program.go#L225>)

```go
func Configuration(config Configurator) Option
```

Configuration is an Option helper to define a configuration structure that will be populated from the sources given on a \-\-config command\-line flag

<a name="NoDefaultFlags"></a>
### func [NoDefaultFlags](<https://github.com/bruceesmith/echidna/blob/main/program/program.go#L443>)

```go
func NoDefaultFlags() Option
```

NoDefaultFlags is a convenience function which is equivalent to calling all of NoJSON, NoLog, NoTrace, and NoVerbose

<a name="NoJSON"></a>
### func [NoJSON](<https://github.com/bruceesmith/echidna/blob/main/program/program.go#L452>)

```go
func NoJSON() Option
```



<a name="NoLog"></a>
### func [NoLog](<https://github.com/bruceesmith/echidna/blob/main/program/program.go#L459>)

```go
func NoLog() Option
```



<a name="NoTrace"></a>
### func [NoTrace](<https://github.com/bruceesmith/echidna/blob/main/program/program.go#L466>)

```go
func NoTrace() Option
```



<a name="NoVerbose"></a>
### func [NoVerbose](<https://github.com/bruceesmith/echidna/blob/main/program/program.go#L473>)

```go
func NoVerbose() Option
```



# <a name="terminator">7. terminator</a>

```go
import "github.com/bruceesmith/echidna/terminator"
```

Package terminator permits orderly stopping / shutdown of a group of goroutines via methods which mimic stop of a sync.WaitGroup.There is a default Terminator accessible through top level functions \(Add, Done, Wait and so on\) that call the corresponding Terminator methods

## Index

- [func Add\(delta int\)](<#Add>)
- [func Done\(\)](<#Done>)
- [func SetDefault\(t \*Terminator\)](<#SetDefault>)
- [func ShutDown\(\) \<\-chan struct\{\}](<#ShutDown>)
- [func ShuttingDown\(\) bool](<#ShuttingDown>)
- [func Stop\(\)](<#Stop>)
- [func Wait\(\)](<#Wait>)
- [type Terminator](<#Terminator>)
  - [func Default\(\) \*Terminator](<#Default>)
  - [func New\(\) \*Terminator](<#New>)
  - [func \(t \*Terminator\) Add\(delta int\)](<#Terminator.Add>)
  - [func \(t \*Terminator\) Done\(\)](<#Terminator.Done>)
  - [func \(t \*Terminator\) ShutDown\(\) \<\-chan struct\{\}](<#Terminator.ShutDown>)
  - [func \(t \*Terminator\) ShuttingDown\(\) bool](<#Terminator.ShuttingDown>)
  - [func \(t \*Terminator\) Stop\(\)](<#Terminator.Stop>)
  - [func \(t \*Terminator\) Wait\(\)](<#Terminator.Wait>)


<a name="Add"></a>
## func [Add](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L48>)

```go
func Add(delta int)
```

Add adds delta to the count of goroutines in the group

<a name="Done"></a>
## func [Done](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L56>)

```go
func Done()
```

Done decrements the count of goroutines in the group by one

<a name="SetDefault"></a>
## func [SetDefault](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L66>)

```go
func SetDefault(t *Terminator)
```

SetDefault sets the default Terminator

<a name="ShutDown"></a>
## func [ShutDown](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L61>)

```go
func ShutDown() <-chan struct{}
```

ShutDown allows code to wait for a shut down signal

<a name="ShuttingDown"></a>
## func [ShuttingDown](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L71>)

```go
func ShuttingDown() bool
```

ShuttingDown returns true if shutdown is in progress

<a name="Stop"></a>
## func [Stop](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L76>)

```go
func Stop()
```

Stop signals that all goroutines in the group should safely exit

<a name="Wait"></a>
## func [Wait](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L82>)

```go
func Wait()
```

Wait blocks until every goroutines in the group has called Done\(\)

<a name="Terminator"></a>
## type [Terminator](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L21-L25>)

Terminator manages groups of goroutines

```go
type Terminator struct {
    // contains filtered or unexported fields
}
```

<a name="Default"></a>
### func [Default](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L53>)

```go
func Default() *Terminator
```

Default returns the default [Terminator](<#Terminator>).

<a name="New"></a>
### func [New](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L87>)

```go
func New() *Terminator
```

New returns a Terminator

<a name="Terminator.Add"></a>
### func \(\*Terminator\) [Add](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L94>)

```go
func (t *Terminator) Add(delta int)
```

Add adds delta to the count of goroutines in the group

<a name="Terminator.Done"></a>
### func \(\*Terminator\) [Done](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L99>)

```go
func (t *Terminator) Done()
```

Done decrements the count of goroutines in the group by one

<a name="Terminator.ShutDown"></a>
### func \(\*Terminator\) [ShutDown](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L104>)

```go
func (t *Terminator) ShutDown() <-chan struct{}
```

ShutDown allows code to wait for a shut down signal

<a name="Terminator.ShuttingDown"></a>
### func \(\*Terminator\) [ShuttingDown](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L109>)

```go
func (t *Terminator) ShuttingDown() bool
```

ShuttingDown returns true if shutdown is in Default\(\).progress

<a name="Terminator.Stop"></a>
### func \(\*Terminator\) [Stop](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L114>)

```go
func (t *Terminator) Stop()
```

Stop signals that all goroutines in the group should safely exit

<a name="Terminator.Wait"></a>
### func \(\*Terminator\) [Wait](<https://github.com/bruceesmith/echidna/blob/main/terminator/terminator.go#L120>)

```go
func (t *Terminator) Wait()
```

Wait blocks until every goroutines in the group has called Done\(\)

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
